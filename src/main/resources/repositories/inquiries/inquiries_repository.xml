<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Inquiries">
	
	<select id="getList" resultType="inquiries">
	SELECT 
	    i.inquiry_num, 
	    i.inquiry_title,
	    i.member_id,
	    i.inquiry_write_date,
	    CASE
	        WHEN i.inquiry_answer_status = '01' THEN '미완료'
	        WHEN i.inquiry_answer_status = '02' THEN '처리완료'
	    END AS inquiry_answer_status, 
	    CASE
	        WHEN i.inquiry_type = '01' THEN '상품문의'
	        WHEN i.inquiry_type = '02' THEN '배송문의'
	        WHEN i.inquiry_type = '03' THEN '결제문의'
	        WHEN i.inquiry_type = '04' THEN '반품문의'
	        WHEN i.inquiry_type = '05' THEN '기타'
	    END AS inquiry_type, 
    	ia.answer_write_date
	FROM 
    	inquiries i
	LEFT JOIN 
    	inquiries_answer ia ON i.inquiry_num = ia.inquiry_num
	</select>
	
	<select id="getDetailList" resultType="inquiries" parameterType="Integer">
	SELECT 
            r.inquiry_num,
            r.inquiry_title,
            r.member_id,
            r.inquiry_write_date,
            r.inquiry_content,
            CASE
	        	WHEN r.inquiry_answer_status = '01' THEN
	        		'미완료'
	        	WHEN r.inquiry_answer_status = '02' THEN
	        		'처리완료'
        	END AS inquiry_answer_status,
            CASE
	        	WHEN r.inquiry_type = '01' THEN
	        		'상품문의'
	        	WHEN r.inquiry_type = '02' THEN
	        		'배송문의'
	        	WHEN r.inquiry_type = '03' THEN
	        		'결제문의'
	        	WHEN r.inquiry_type = '04' THEN
	        		'반품문의'
	        	WHEN r.inquiry_type = '05' THEN
	        		'기타'
        	END AS inquiry_type,
            r.inquiries_changed,
            c.answer_content
        FROM
            inquiries r
        LEFT OUTER JOIN
            inquiries_answer c
        ON
            r.inquiry_num = c.inquiry_num
        WHERE
            r.inquiry_num = #{inquiryNum}
	</select>
	
	<update id="updateInquiry" parameterType="inquiries">
		UPDATE 
			inquiries_answer
		SET
			answer_content = #{answer_content},
			answer_write_date = CURRENT_TIMESTAMP
		WHERE 
			inquiry_num = #{inquiry_num}
			
	
	</update>
	
	
	<insert id="insertInquiry" parameterType="inquiries">
		INSERT INTO 
			inquiries_answer 
			(
		        inquiry_num, 
		        answer_content, 
		        answer_write_date,
		        manager_id
	    	) 
    	VALUES (
		        #{inquiryNum}, 
		        #{answerContent}, 
		        CURRENT_TIMESTAMP,
		        #{managerId}
    		)
	
	</insert>
</mapper>