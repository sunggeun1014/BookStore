<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ezen.bookstore.mobile.home.mapper.DeliveryMapper">
	<select id="getRequestList" resultType="deliveryDTO">
		SELECT 
		    dr.request_num, 
		    dr.request_date,
		    drd.request_detail_num, 
		    drd.order_num, 
		    SUM(cod.order_detail_qty) AS total_order_qty
		FROM 
		    delivery_request dr
		JOIN 
		    delivery_request_detail drd ON dr.request_num = drd.request_num
		JOIN 
		    customer_order_details cod ON drd.order_num = cod.order_num
		WHERE 
		    dr.request_end_date IS NULL
		GROUP BY 
		    dr.request_num, dr.request_date, drd.request_detail_num, drd.order_num
		ORDER BY 
			dr.request_date ASC
    
	</select>
	
	<select id="getRequestDetail" parameterType="Integer" resultType="deliveryDTO">
		SELECT
			cod.order_num,
			cod.book_isbn,
			cod.order_detail_qty,
			b.book_name
		FROM
			customer_order_details cod
		JOIN
			books b ON cod.book_isbn = b.book_isbn
		WHERE
			cod.order_num = #{order_num}
	</select>
</mapper>