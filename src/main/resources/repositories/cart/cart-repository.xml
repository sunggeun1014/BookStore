<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Cart">

    <select id="getCartItemList" resultType="userCart">
        SELECT 
        	c.cart_num, 
        	c.book_isbn, 
        	b.book_name, 
        	c.cart_purchase_qty, 
        	b.book_price,
        	b.book_thumbnail_changed
        FROM 
        	orders_cart c
        JOIN 
        	books b ON b.book_isbn = c.book_isbn
        WHERE 
        	c.member_id = #{member_id}
    </select>
    
    <insert id="addCartItem" parameterType="userCart">
        INSERT INTO
		orders_cart (
			cart_num,
			book_isbn,
			member_id,
			cart_purchase_qty
        ) VALUES (
        		order_cart_seq.nextval,
        		#{book_isbn},
				#{member_id},
				#{cart_purchase_qty}
		)
    </insert>
    
    <delete id="deleteItemsByCartNums">
    	DELETE FROM 
    		orders_cart
    	WHERE 
    		cart_num IN
    	<foreach item="cart_num" collection="cartNums" open="(" separator="," close=")">
            #{cart_num}
        </foreach>
        AND member_id = #{member_id}
    </delete>
    
    <delete id="deleteItemsByMemberId">
    	DELETE FROM 
    		orders_cart
    	WHERE
    		member_id = #{member_id}
    </delete>
    
    
    <select id="basketCount" resultType="Integer" parameterType="String">
    	SELECT 
    		COUNT(*) 
    	FROM 
    		orders_cart 
    	WHERE
    		member_id = #{member_id}
    </select>
</mapper>