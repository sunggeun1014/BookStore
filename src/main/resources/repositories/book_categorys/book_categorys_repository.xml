<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BookCategorys">

	<select id="getCategoryList" resultType="userCategory" parameterType="userCondition">
		SELECT
		    bc.category_num,
		    bc.category_name,
		    NVL((SELECT COUNT(*) FROM books 
		    	WHERE 
		    		book_category = bc.category_name
		    	<if test="word != null and !word.equals('')">
					<if test="search_conditions.equals('book_title')">
						and REPLACE(LOWER(book_name), ' ', '') LIKE '%' || REPLACE(LOWER(#{word}), ' ', '') || '%'
					</if>
					<if test="search_conditions.equals('book_author')">
						and REPLACE(LOWER(book_author), ' ', '') LIKE '%' || REPLACE(LOWER(#{word}), ' ', '') || '%'
					</if>
					<if test="search_conditions.equals('book_publisher')">
						and REPLACE(LOWER(book_publisher), ' ', '') LIKE '%' || REPLACE(LOWER(#{word}), ' ', '') || '%'
					</if>
				</if>
		    ), 0) AS category_cnt
		FROM
		    book_categorys bc
		LEFT JOIN books b ON bc.category_name = b.book_category
		GROUP BY
		    bc.category_num,
		    bc.category_name
		ORDER BY
		    bc.category_name ASC
		    
	</select>

</mapper>